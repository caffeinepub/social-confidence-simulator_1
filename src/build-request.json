{
  "kind": "build_request",
  "title": "Social Confidence Simulator: scenario-based conversation practice with avatar, live metrics, and progress tracking",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Create a Home/Dashboard screen with app branding and scenario selection for: Job Interview, First Date, Party, Networking Event, plus a “Start Practice Now” button that starts a default scenario for first-time users.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Main Dashboard (Home Screen): ... Scenario Selection Section ... Job Interview, First Date, Party, Networking Event. ... Quick Start Button: “Start Practice Now”"
        ]
      },
      "acceptanceCriteria": [
        "Home screen shows app title “Social Confidence Simulator” and a logo.",
        "Four scenario cards/buttons are visible and selectable on desktop and tablet breakpoints.",
        "“Start Practice Now” starts a session using a deterministic default scenario when no prior sessions exist (e.g., stored locally or in canister).",
        "Selecting a scenario navigates into the conversation screen with that scenario active."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Implement the Conversation screen with a 3-panel layout: (1) AI Avatar panel with mood/expression display, (2) chat-style conversation history (AI and user messages visually distinct), and (3) metrics & feedback panel showing anxiety/confidence and tips.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Conversation Window: Split into three main panels: AI Avatar Panel ... Chat Panel ... Metrics & Feedback Panel"
        ]
      },
      "acceptanceCriteria": [
        "Conversation layout clearly contains avatar, chat history, and metrics/tips panels on desktop; stacks sensibly on tablet.",
        "Chat history renders AI messages and user messages with different styling and clear attribution.",
        "Chat input area includes a text input with placeholder “Type your response here…”.",
        "Metrics panel shows a single anxiety/confidence score (0–100) with a visual meter and lists key metrics (WPM, filler words count, hesitations).",
        "Feedback panel displays 1–3 actionable tips that update after each user message."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add a voice input option using in-browser speech-to-text (Web Speech API) to populate/send the user’s message, including a microphone button and clear states (idle/listening/error).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Voice Input Button with microphone icon for real-time speech-to-text input.",
          "Real-time speech-to-text analysis using Web Speech API or browser recognition"
        ]
      },
      "acceptanceCriteria": [
        "Microphone button starts/stops speech recognition on supported browsers.",
        "Recognized text is shown in the input box before sending (or is sent on stop, per UI choice) and can be edited.",
        "If the browser does not support speech recognition, the UI shows an English fallback message and disables the mic button.",
        "Voice input does not require any external service integration."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Implement scenario-specific conversation flow in the backend using predefined prompts/personalities per scenario, producing the next AI message based on the session state and the latest user message (no external LLM dependencies).",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Scenario-Specific Prompts: AI asks scenario-relevant questions and reacts naturally.",
          "Conversation management (sending user input to OpenAI GPT API)"
        ]
      },
      "acceptanceCriteria": [
        "Backend provides an API to start a session for a given scenario and returns an initial AI message.",
        "Backend provides an API to submit a user message and returns: next AI message, updated metrics, updated tips, and avatar mood.",
        "Each scenario produces distinct starter prompts and follow-up questions (deterministic and testable).",
        "No calls to OpenAI/GPT or any third-party LLM services are present."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Implement rule-based anxiety/confidence analysis on user text (and derived voice timing metrics from the frontend if available), including: filler word count, hesitations, self-doubt phrases, sentence length, and an overall anxiety/confidence score (0–100).",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Backend analyzes: Text: Filler words, self-doubt phrases, hesitations, sentence length.",
          "Real-time anxiety/confidence score (0–100%) with a visual meter (like a speedometer or colored bar).",
          "Voice: Speaking rate, pause frequency, pitch variance, volume fluctuations."
        ]
      },
      "acceptanceCriteria": [
        "For each user message, the system computes filler word count and a list of matched filler tokens (e.g., “um”, “uh”, “like”).",
        "System computes a simple hesitations metric from text (e.g., ellipses, repeated words) and optionally from frontend-provided pause counts when voice input is used.",
        "System computes words-per-minute (WPM) when voice input is used and otherwise estimates WPM from typed timestamps.",
        "System produces a single score (0–100) where higher means more confident (or clearly label direction) and returns a corresponding mood category (e.g., anxious/neutral/confident/encouraging).",
        "Metrics returned by backend are displayed in the UI and update after each turn."
      ]
    },
    {
      "id": "REQ-6",
      "text": "Add a “Retry response” flow that lets the user re-attempt their last message and immediately see updated metrics/tips without losing the full session context.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Option to retry a response to immediately apply tips."
        ]
      },
      "acceptanceCriteria": [
        "UI provides a visible “Retry response” action after a user message.",
        "Retrying replaces (or clearly versions) the last user message in the session and recomputes metrics/tips for that turn.",
        "Chat transcript remains coherent (no broken ordering); the UI clearly indicates the retried message if both versions are preserved."
      ]
    },
    {
      "id": "REQ-7",
      "text": "Implement a Session Summary view shown when a session ends, including: full transcript, a confidence score progression chart, a personalized tips summary, and an option to save the session for progress tracking.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Step 4: Session Summary ... Full transcript of chat. Graph showing confidence score progression. Personalized tips summary. Option to save session for tracking progress over time."
        ]
      },
      "acceptanceCriteria": [
        "User can end a session via a clear UI control, which navigates to a summary screen.",
        "Summary shows the full transcript (AI + user messages).",
        "Summary includes a chart of confidence/anxiety score over time (turn-by-turn).",
        "Summary lists a compact set of personalized tips derived from the session’s tips.",
        "User can save the session; saved sessions are retrievable later for progress tracking."
      ]
    },
    {
      "id": "REQ-8",
      "text": "Add a Progress Tracker that visualizes improvement across multiple saved sessions (e.g., mini chart and session history list) and is accessible from the dashboard.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Progress Tracker: Mini chart showing improvement across multiple sessions."
        ]
      },
      "acceptanceCriteria": [
        "Dashboard includes a progress section showing at least one chart/summary derived from saved sessions.",
        "User can view a list of past sessions with date/time, scenario, and an aggregate score.",
        "Selecting a past session opens its saved summary (transcript + charts + tips)."
      ]
    },
    {
      "id": "REQ-9",
      "text": "Add a Settings area with: avatar type selection (cartoon / 3D / GIF as UI choices, implemented at least with cartoon/GIF swapping), voice feedback on/off, language selection (UI text remains English; language selection may be a stored preference without full localization), and a dark/light mode toggle.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Settings Menu: Change avatar type (cartoon, 3D, GIF), voice feedback on/off, language selection.",
          "Dark/Light Mode Toggle for user comfort.",
          "Use English for any user-facing text in the build request."
        ]
      },
      "acceptanceCriteria": [
        "Settings screen/modal is reachable from the dashboard and conversation screens.",
        "Dark/light mode toggles the UI theme and persists across reloads.",
        "Avatar type selection changes the avatar presentation used in the conversation screen (at minimum: different static/animated assets for cartoon vs GIF).",
        "Voice feedback toggle persists and controls whether the app plays any voice output (if implemented).",
        "Language selection is present and persisted, while all visible UI text remains English unless further localization is implemented later."
      ]
    },
    {
      "id": "REQ-10",
      "text": "Implement avatar mood/expression updates driven by the computed confidence/anxiety state (neutral, confident, anxious, encouraging), including smooth transitions and optional speech bubble animation for AI dialogue.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Animated avatar showing expressions: neutral, confident, anxious, encouraging.",
          "Avatar reacts dynamically based on user input and detected anxiety.",
          "Optional: Speech bubble animation for AI dialogue."
        ]
      },
      "acceptanceCriteria": [
        "Avatar supports at least 4 discrete mood states and visibly changes when backend mood changes.",
        "Mood changes occur after each user turn and on AI response render.",
        "Transitions are animated (e.g., fade/slide) and do not cause layout jumps.",
        "If speech bubble is implemented, it appears near the avatar when AI messages are displayed."
      ]
    },
    {
      "id": "REQ-11",
      "text": "Persist sessions and user preferences in the Motoko canister (single-actor) so progress and summaries remain available across devices for the same Internet Identity principal (if II is already in the template) or otherwise persist locally as a fallback for unauthenticated users.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Option to save session for tracking progress over time."
        ]
      },
      "acceptanceCriteria": [
        "Saved sessions persist across page reloads.",
        "When a user identity is available, sessions are stored keyed by the user principal; otherwise, the app falls back to local persistence and clearly labels that progress is device-local.",
        "Backend provides APIs to list sessions, fetch a session by id, and save a completed session.",
        "No additional backend services or databases are introduced."
      ]
    },
    {
      "id": "REQ-12",
      "text": "Create a cohesive, modern visual theme and apply it consistently across dashboard, conversation, summary, and settings screens (avoid blue/purple as the primary palette).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "The interface should be engaging, modern, and intuitive, suitable for both desktop and tablet displays.",
          "Simple, clean interface: minimal clutter, large readable text"
        ]
      },
      "acceptanceCriteria": [
        "UI uses a consistent color palette, typography scale, spacing system, and component styling across all screens.",
        "Primary palette is not blue/purple-dominant unless explicitly requested later.",
        "Layout is responsive and usable on common tablet widths and desktop widths."
      ]
    },
    {
      "id": "REQ-13",
      "text": "Add generated static image assets (logo, scenario icons, avatar states) to the frontend and render them in the corresponding UI locations (store under frontend/public/assets/generated and reference them directly from the frontend).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Header: App logo and title: “Social Confidence Simulator”",
          "Each card has a small icon or animated illustration representing the scenario.",
          "Animated avatar showing expressions: neutral, confident, anxious, encouraging."
        ]
      },
      "acceptanceCriteria": [
        "All required generated images are present under frontend/public/assets/generated.",
        "Dashboard uses the generated scenario icons on the scenario cards.",
        "Header displays the generated logo.",
        "Conversation avatar uses the generated avatar-state images for mood switching.",
        "No generated images are served through the backend."
      ]
    },
    {
      "id": "REQ-14",
      "text": "(Optional demo features) Add QR codes on scenario cards that encode a URL to open the app with the scenario pre-selected, and add an optional AI voice playback feature that can read back suggested responses using browser text-to-speech (no external services).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Scenario Cards with QR Codes: Users can scan and start on their own device.",
          "Voice Playback Option: AI can read back suggested responses."
        ]
      },
      "acceptanceCriteria": [
        "Each scenario card can display a QR code that links to a URL including the scenario as a query parameter.",
        "Opening the app via the QR code URL pre-selects the scenario and opens the conversation screen.",
        "If voice playback is enabled in settings, the app can read tips/suggested responses using browser TTS; if disabled, no speech is played."
      ]
    }
  ],
  "constraints": [
    "Backend must be implemented in Motoko as a single-actor canister (no additional backend services).",
    "Do not implement any external LLM integration (e.g., OpenAI/Anthropic) or require API keys.",
    "Do not use WebSockets/Socket.io; use request/response updates (polling only if necessary).",
    "Frontend must use React + TypeScript with Tailwind, shadcn/ui composition, and React Query.",
    "Do not edit files under frontend/src/components/ui or the other immutable paths listed in SYSTEM_CONTEXT; compose them instead.",
    "All user-facing text must be in English."
  ],
  "nonGoals": [
    "Third-party authentication providers other than Internet Identity.",
    "Machine-learning-based emotion detection models or external inference services.",
    "True real-time audio emotion analysis (pitch/volume variance) beyond what the browser can provide locally without external services.",
    "Public leaderboards/gamification with global rankings (can be added later if needed)."
  ],
  "imageRequirements": {
    "required": [
      "App logo mark, clean modern flat style (social-confidence-simulator-logo.dim_512x512.png)",
      "Scenario icon: job interview, flat illustration (scenario-job-interview-icon.dim_256x256.png)",
      "Scenario icon: first date, flat illustration (scenario-first-date-icon.dim_256x256.png)",
      "Scenario icon: party, flat illustration (scenario-party-icon.dim_256x256.png)",
      "Scenario icon: networking event, flat illustration (scenario-networking-icon.dim_256x256.png)",
      "Avatar state: neutral, front-facing character illustration (avatar-neutral.dim_512x512.png)",
      "Avatar state: confident, front-facing character illustration (avatar-confident.dim_512x512.png)",
      "Avatar state: anxious, front-facing character illustration (avatar-anxious.dim_512x512.png)",
      "Avatar state: encouraging, front-facing character illustration (avatar-encouraging.dim_512x512.png)"
    ],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}